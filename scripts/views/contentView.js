define(["jquery","underscore","backbone","other/cheeringMessage","../other/pageTypeList","other/panelHeight"],function(e,t,n,r,i,s){var o=n.View.extend({el:e("#watch #contentBlock"),loadAlbumsList:function(){var t=this,n={fields:"entry(title,updated,gphoto:numphotos,gphoto:id,media:group(media:thumbnail))",kind:"album",thumbsize:"59c"};e.getJSON("https://picasaweb.google.com/data/feed/api/user/default?callback=?",n,function(n){t.$el.children(".contentBlockPart").hide();var i=t.$el.children("#albumsContentBlock");i.empty();var s=i.append("<ul>").children();e.each(n.feed.entry,function(e,t){var n={};n.title=t.title.$t,n.updated=t.updated.$t,n.numphotos=t.gphoto$numphotos.$t,n.id=t.gphoto$id.$t,n.url=t.media$group.media$thumbnail[0].url,require(["views/albumPictureItemView","models/albumPictureItemModel"],function(e,t){var r=new e({model:new t(n)});s.append(r.render().$el)})}),t.model.setNewHeader(r.get()),i.show()})},loadPhotosList:function(n,r,i){var s=this,o={fields:"title,entry(title,summary,gphoto:id,media:group(media:thumbnail))",kind:"photo",thumbsize:"105c","max-results":r},u=this.model.get("searchStr");u!=""&&(o.q=u),e.getJSON("https://picasaweb.google.com/data/feed/api/user/default/albumid/"+n+"?callback=?",o,function(n){var o=s.$el.children("#photosContentBlock");i!=0&&s.$el.children(".contentBlockPart").hide(),n.feed.entry!=undefined?require(["collections/photosGridModelsList","models/photosGridModel","views/photosGridView","libs/tooltip"],function(i,u,a){var f=new i;e.each(n.feed.entry,function(n,r){var i=t.template(e("#tooltip-item-template").html()),s="<table>"+i({title:r.title.$t,description:r.summary.$t})+"</table>";f.add(new u({id:r.gphoto$id.$t,url:r.media$group.media$thumbnail[0].url,tooltipHtml:s}))}),o.show();var l=new a({model:f});o.empty(),o.append(l.$el),l.render(),s.model.setNewHeader(n.feed.title.$t),e(".item>div>div").tooltip({placement:"bottom",html:!0}),n.feed.entry.length<r?s.noNeedToLoadRest=!0:s.noNeedToLoadRest=!1}):(o.empty(),o.append("<div id='noRes'>"),o.children().text("No Results"),s.model.setNewHeader(n.feed.title.$t),o.show())})},getScreenWidth:function(){return e(window).width()-20},loadPhoto:function(t){var n=this,r=this.getScreenWidth();r=r?r:1,e.getJSON("https://picasaweb.google.com/data/feed/api/user/default/photoid/"+t+"?callback=?",{fields:"media:group(media:content,media:description,media:title,media:keywords)",imgmax:r},function(e){n.$el.children(".contentBlockPart").hide();var t=n.$el.children("#photoContentBlock");t.empty(),require(["models/photoModel","views/photoView"],function(r,i){var s={};s.title=e.feed.media$group.media$title.$t,s.url=e.feed.media$group.media$content[0].url,s.description=e.feed.media$group.media$description.$t,s.keywords=e.feed.media$group.media$keywords.$t,s.albumTitle=e.feed.media$group.media$title.$t;var o=new i({model:new r(s)});t.append(o.$el),o.render(),n.model.setNewHeader(s.albumTitle),t.show()})})},initialize:function(){var t=this,n=function(){if(t.model.get("pageType")==i[2]){var n=/^(.+\/)s(\d+)(\/.+)$/i,r=t.getScreenWidth(),s=e("#photoDiv>div>img").attr("src").replace(n,"$1s"+r+"$3");e("#photoDiv>div>img").attr("src",s)}},r=function(){var n=e(window).height()-s,r=Math.floor((n>0?n:0)/141)+1,o=Math.floor(e(window).width()/111);return t.needToLoadCount=r*o,t.model.get("pageType")==i[1]&&(t.needToLoadCount>t.loadedCount?t.loadPhotosList(t.model.get("albumId"),t.needToLoadCount):t.adding=o-t.loadedCount%o),t.needToLoadCount};this.listenTo(this.model,"change:pageType",this.render),this.listenTo(this.model,"change:searchStr",this.search),this.render(),e(window).resize(r),e(window).resize(n),this.noNeedToLoadRest=!1,this.loadedCount=r(),this.adding=0,e(window).scroll(function(){t.model.get("pageType")==i[1]&&e(window).scrollTop()+e(window).height()>=e(document).height()-40&&!t.noNeedToLoadRest&&(t.noNeedToLoadRest=!0,t.loadedCount+=t.needToLoadCount+t.adding,t.loadPhotosList(t.model.get("albumId"),t.loadedCount,!1),t.adding=0)}),e("#searchHolder input").on("keyup",function(){t.model.set({searchStr:e("#searchHolder input").val()})})},render:function(){var t=function(){e("body").css("height","");var t=e("#photosInAlbum");t.length>0&&(e("#photosInAlbum").empty(),e("#photosInAlbum").jresponsive({transormation:"animation",min_size:0,max_size:0,height:129,hspace:12,vspace:12,class_name:"item2",content_array:[""]}))};this.model.get("pageType")==i[0]?(this.loadAlbumsList(),t()):this.model.get("pageType")==i[1]?(this.loadedCount=this.needToLoadCount,this.loadPhotosList(this.model.get("albumId"),this.needToLoadCount)):(this.loadPhoto(this.model.get("photoId")),t())},search:function(){this.model.get("pageType")==i[1]&&this.render()}});return o});